# AIDL and Binder

## Overview

The 2023 RDK HAL study identified key design goals for a new HAL interface and implementation, focusing on the following aspects:

### Design Goals

- **Clean Separation:** Clear division between middleware and vendor layers.
- **Process Isolation:** Middleware and vendor layers operate in separate processes and memory spaces.
- **Late Binding:** Decoupling of middleware from vendor HAL components at build time.
- **Versioning:** Versioned interfaces with forward and backward compatibility.
- **Performance:** High-performance Inter-Process Communication (IPC).
- **Testability:** Standalone testability for the vendor layer.
- **Debuggability:** Enhanced debugging tools.

## Binder

Binder serves as the IPC mechanism, offering both synchronous and asynchronous calls suitable for the high-frequency communication required by subsystems like A/V. Defining most HAL interfaces as Binder services provides:

- **Process and Memory Isolation:** Enhancing testability and improving memory management.
- **Late Binding:** Eliminates build-time dependencies on vendor HAL libraries, promoting independent delivery of middleware and vendor layers.

Binder is implemented as a Linux kernel driver that must be enabled during kernel compilation.

## AIDL

AIDL (Android Interface Definition Language) is used to define the interfaces for Binder services. RDK leverages C++ bindings generated by the AIDL tool to create client-side proxy and server-side stub implementations. All Binder-based HAL interfaces are defined in AIDL files, typically located in a dedicated repository (e.g., `rdk-halif-aidl`).

Stable AIDL is crucial for maintaining compatibility across interface versions. It enables runtime version detection, allowing clients to verify the HAL service version they are communicating with. This ensures interoperability even when client and server components are built against different interface versions.

## Key Concepts and Benefits

- **Interface Definition:** AIDL defines the contract between the client and server.
- **Code Generation:** The AIDL compiler generates the necessary code for Binder communication.
- **Proxy/Stub:** Client-side proxies handle communication with the server, while server-side stubs receive and process requests.
- **Versioning:** Stable AIDL allows for interface evolution while preserving backward compatibility.
- **Process Isolation:** Binder services run in separate processes, improving system stability.
- **Late Binding:** Reduces dependencies and simplifies updates.

## Useful External Links

- **RDK HAL AIDL Git Repository:** [RDK HAL AIDL](https://github.com/rdkcentral/rdk-halif-aidl)
- **Kernel Binder Driver:** [Kernel Binder](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/android?h=v5.15.164)

## **AIDL Documentation:**

 - [AIDL Overview](https://developer.android.com/develop/background-work/services/aidl)
 - [AIDL Core Architecture](https://source.android.com/docs/core/architecture/aidl)
 - [AIDL Language](https://source.android.com/docs/core/architecture/aidl/aidl-language)
 - [AIDL HALs](https://source.android.com/docs/core/architecture/aidl/aidl-hals)
 - [Stable AIDL](https://source.android.com/docs/core/architecture/aidl/stable-aidl)

## **Binder Tracing Tools:**

 - [Binder Trace](https://github.com/foundryzero/binder-trace)
 - [Binder Tracing Part 2](https://www.foundryzero.co.uk/2022/11/14/binder-tracing-part-2.html)
 - [Eclipse Trace Compass](https://eclipse.dev/tracecompass/)
 - [Android Performance Tracing](https://developer.android.com/topic/performance/tracing)
 - [Binder Explorer](https://github.com/opersys/binder-explorer-web)

