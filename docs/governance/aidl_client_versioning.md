# **Architecture Governance Document: AIDL Client Versioning**

## **1. Purpose**

This document defines the policy for managing a **single, fixed version** of autogenerated AIDL client stubs within each client component. It ensures version traceability and consistency without enforcing automated regeneration or validation during builds.

---

## **2. Goals**

* Enforce clear coupling between each client component and its corresponding AIDL interface version.
* Allow client developers to control when and how they upgrade interface versions.
* Maintain clarity and traceability of interface usage without incurring build-time or CI overhead.

---

## **3. Directory Structure**

Each component must include a committed client stub under a standard location:

```bash
<component>/
├── client_interface/
│   ├── IComponentClient.h
│   ├── IComponentClient.cpp
│   └── AIDL_VERSION.txt
├── include/
├── src/
└── regen-client-stubs.sh
```

* `client_interface/`: Stores the fixed client stub for the current interface version.
* `AIDL_VERSION.txt`: Captures metadata about the interface used to generate the stub.
* `regen-client-stubs.sh`: Script to regenerate the stub when the interface version is upgraded.

---

## **4. AIDL_VERSION.txt Format**

This file must accompany all client stubs and contain the following metadata:

```txt
AIDL Interface: com.example.IComponent
AIDL Version: 1.1
Interface SHA256: e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855
Generated By: aidl-cpp version 1.4.0
Generated On: 2025-07-14
```

---

## **5. Developer Workflow**

Client developers are **solely responsible** for managing client stub upgrades. When moving to a newer interface version:

* They must manually regenerate the stub using the provided script.
* They must update `AIDL_VERSION.txt` with the new metadata.
* These changes must be submitted together in the same PR.

**Clarification:**

> There is no requirement to perform validation during build or CI.
> Interface version movement is **intentional and manual**, and the stub must always match the interface version defined in `AIDL_VERSION.txt` at the time of commit.

---

## **6. Developer Responsibilities**

| Role             | Responsibilities                                                                                               |
| ---------------- | -------------------------------------------------------------------------------------------------------------- |
| Interface Owner  | Publishes `.aidl` files with version metadata and SHA                                                          |
| Client Developer | Regenerates the client stub and updates `AIDL_VERSION.txt` when intentionally adopting a new interface version |
| Reviewer         | Verifies that any change to the stub is accompanied by an updated version file and generated code              |

---

## **7. Rationale**

This governance model reflects a **developer-driven interface evolution strategy**, avoiding redundant validation while ensuring:

* **Version traceability**
* **Deliberate updates**
* **No reliance on build-time regeneration or checks**

It offers a clear and efficient workflow for any component that consumes AIDL-defined interfaces.

## **8. Document History**

|Version|Author|Date|Comment|
|-------|------|----|-------|
|0.1.0 (Draft)| G. Weatherup | 15 July 2025 | Draft Revision |